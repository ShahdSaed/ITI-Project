<!-- Loading state -->
@if (loading) {
  <div class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading movie details...</p>
  </div>
}

<!-- Error state -->
@if (error) {
  <div class="text-center py-5">
    <div class="alert alert-danger" role="alert">
      {{ error }}
    </div>
    <button class="btn btn-primary" (click)="loadMovieDetails()">Try Again</button>
    <button class="btn btn-secondary ms-2" (click)="goBack()">Go Back</button>
  </div>
}

<!-- Movie details -->
@if (!loading && !error && movie) {
  <section class="details-container">
    <div class="details-main">
      <div class="poster">
        <img [src]="getImageUrl(movie.poster_path)" [alt]="movie.title" />
      </div>

      <div class="movie-info">
        <div class="title-with-heart">
          <h1>{{ movie.title }}</h1>
          <div class="css-heart" [ngClass]="{ 'active': isInWatchlist(movieId) }" (click)="toggleWatchlist(movieId)" title="Add to Watchlist"></div>
        </div>
        <span class="releaseYear">{{ formatDate(movie.release_date) }}</span>
        @if (starsArray.length) {
          <div class="rating-stars">
            @for (star of starsArray; track $index) {
              <span [ngClass]="{
                  'star': true,
                  'full-star': star === 'full',
                  'half-star': star === 'half',
                  'empty-star': star === 'empty'
                  }">â˜…</span>
            }
            <span class="votes">({{ movie.vote_count | number }} reviews)</span>
          </div>
        }
        <br>

        <div class="details-list">
          <p class="description"><b>{{ movie.overview || 'No description available.' }}</b></p>
          <div class="meta-info">
            <div><strong>Rating:</strong> {{ getRatingPercentage(movie.vote_average) }}%</div>
            <div><strong>Popularity:</strong> {{ movie.popularity | number:'1.0-0' }}</div>
            <div><strong>Language:</strong> {{ movie.original_language | uppercase }}</div>
            <div><strong>Original Title:</strong> {{ movie.original_title }}</div>
          </div>
        </div>
      </div>
    </div>

    <hr>

    <section class="recommendations">
      <h2>Recommendations</h2>
      <div class="recommendations-grid">
        @for (rec of recommendations; track rec.id) {
          <div class="recommendation-item">
            <app-media-card
              [title]="rec.title"
              [date]="formatDate(rec.release_date)"
              [rating]="getRatingPercentage(rec.vote_average)"
              [imageUrl]="getImageUrl(rec.poster_path)"
              [id]="rec.id"
              [isLiked]="false">
            </app-media-card>
          </div>
        }
      </div>
    </section>
  </section>
}
